syntax = "proto3";

option java_multiple_files = true;
option java_package = "com.datarango.grpc.course";

package course;

import "category.proto";
import "industry.proto";
import "quiz.proto";
import "user.proto";

service CourseService {
  rpc CreateCourse(CreateCourseRequest) returns (Course);
  rpc GetCourse(GetCourseRequest) returns (Course);
  rpc UpdateCourse(UpdateCourseRequest) returns (Course);
  rpc DeleteCourse(DeleteCourseRequest) returns (DeleteCourseResponse);
  rpc ListCourses(ListCoursesRequest) returns (ListCoursesResponse);
  rpc EnrollCourse(EnrollCourseRequest) returns (CourseEnrollment);
  rpc GetCourseProgress(GetCourseProgressRequest) returns (CourseProgress);
  rpc UpdateCourseProgress(UpdateCourseProgressRequest) returns (CourseProgress);
}

enum Pricing {
  PRICING_FREE = 0;
  PRICING_PREMIUM = 1;
}

message Course {
  string id = 1;
  string title = 2;
  string description = 3;
  string difficulty_level = 4;
  Industry industry = 5;
  Category category = 6;
  repeated Module modules = 7;
  int64 duration_minutes = 8;
  int64 average_rating = 9;
  int64 enrollments_count = 10;
  bool is_published = 11;
  User creator = 12;
  Pricing pricing = 13;
  string image_url = 14;
  User created_by = 15;
  int64 created_at = 16;
  int64 updated_at = 17;
}

message Module {
  string id = 1;
  string course_id = 2;
  string title = 3;
  string description = 4;
  int32 sequence_number = 5;
  string video = 6;
  string transcript = 7;
  repeated string attachments = 8;
  bool is_completed = 9;
  repeated Quiz quiz = 10;
  User created_by = 11;
  int64 created_at = 12;
  int64 updated_at = 13;
}

message CourseEnrollment {
  string id = 1;
  string course_id = 2;
  string user_id = 3;
  int64 enrolled_at = 4;
  int64 completed_at = 5;
  bool is_completed = 6;
  int32 progress_percentage = 7;
  User created_by = 8;
  int64 created_at = 9;
  int64 updated_at = 10;
}

message CourseProgress {
  string course_id = 1;
  string module_id = 2;
  string user_id = 3;
  int64 last_watched = 4;
  bool is_completed = 5;
  int32 current_time_elapsed = 6;
  int32 total_time_watched = 7;
}

message Video {
  string id = 1;
  string module_id = 2;
  string title = 3;
  string description = 4;
  string video_url = 5;
  int32 duration_seconds = 6;
  string transcript = 7;
  int32 sequence_number = 8;
  User created_by = 9;
  int64 created_at = 10;
  int64 updated_at = 11;
}

message CreateCourseRequest {
  string title = 1;
  string description = 2;
  string difficulty_level = 3;
  string industry_id = 4;
  string category_id = 5;
  Pricing pricing = 6;
  string image_url = 7;
}

message GetCourseRequest {
  string id = 1;
}

message UpdateCourseRequest {
  string id = 1;
  string title = 2;
  string description = 3;
  string difficulty_level = 4;
  string industry_id = 5;
  string category_id = 6;
  bool is_published = 7;
  Pricing pricing = 8;
  string image_url = 9;
}

message DeleteCourseRequest {
  string id = 1;
}

message DeleteCourseResponse {
  bool success = 1;
}

message ListCoursesRequest {
  string category_id = 1;
  string industry_id = 2;
  Pricing pricing = 3;
  bool published_only = 4;
  int32 page = 5;
  int32 size = 6;
}

message ListCoursesResponse {
  repeated Course courses = 1;
  int32 total_count = 2;
  int32 page = 3;
  int32 size = 4;
}

message EnrollCourseRequest {
  string course_id = 1;
  string user_id = 2;
}

message GetCourseProgressRequest {
  string course_id = 1;
  string user_id = 2;
}

message UpdateCourseProgressRequest {
  string course_id = 1;
  string module_id = 2;
  string user_id = 3;
  int32 current_time_elapsed = 4;
  int32 total_time_watched = 5;
  bool is_completed = 6;
}